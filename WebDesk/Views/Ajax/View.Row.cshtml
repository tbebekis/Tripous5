@model ViewRowModel
@{
    string ColumnCssClasses = !string.IsNullOrWhiteSpace(Model.Def.ColumnCssClasses) ? Model.Def.ColumnCssClasses : ViewRowDef.DefaultColumnCssClasses;
    string CtrlRowCssClass;

    SqlBrokerDef BrokerDef = !string.IsNullOrWhiteSpace(Model.ViewDef.BrokerName) ? SqlBrokerDef.Find(Model.ViewDef.BrokerName) : null;
    SqlBrokerTableDef TableDef = BrokerDef != null && !string.IsNullOrWhiteSpace(Model.Def.TableName) ? BrokerDef.FindTable(Model.Def.TableName) : null;
    SqlBrokerFieldDef FieldDef;
    string ControlDataSetupText = "";

    SqlBrokerFieldDef GetFieldDef(ViewControlDef ControlDef)
    {
        var Tuple = TableDef != null ? TableDef.FindAnyField(ControlDef.DataField) : null;
        return Tuple != null ? Tuple.Item2 : null;
    }

    // Examples of control row
    // <div class="tp-CtrlRow" data-setup="{Text: 'Code', Control: { TypeName: 'TextBox', DataField: 'Code' } }"></div>
    // <div class="tp-CtrlRow" data-setup="{Text: 'Test', Control: { TypeName: 'ComboBox', DataField: '', Mode: 'ListOnly', ListValueField: 'Id', ListDisplayField: 'Name', List: [{Id: 100, Name: 'All'}, {Id: 0, Name: 'No stops'}, {Id:1, Name: '1 stop'}], SelectedIndex: 0} }"></div>

}


<div class="tp-Row">
    @if (Model.Def.Grid != null)
    {
        ControlDataSetupText = Model.Def.Grid.GetDataSetupText();
        <div class="Grid" data-setup='@Html.Raw(ControlDataSetupText)'></div>
    }
    else if (Model.Def.Columns != null && Model.Def.Columns.Count > 0)
    {
        // columns
        foreach (var Col in Model.Def.Columns)
        {
            <div class='@Html.Raw(ColumnCssClasses)'>
                @foreach (var Ctrl in Col.Controls)
                {
                    CtrlRowCssClass = Ctrl.TypeName == ViewControlDef.CheckBox ? "tp-CheckBoxRow" : "tp-CtrlRow";
                    FieldDef = GetFieldDef(Ctrl);
                    if (FieldDef != null)
                        Ctrl.AssignField(FieldDef);
                    ControlDataSetupText = Ctrl.GetDataSetupText();
                    <div class='@Html.Raw(CtrlRowCssClass)' data-setup='@Html.Raw(ControlDataSetupText)'></div>
                }
            </div>
        }
    }

</div>
